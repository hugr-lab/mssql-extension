# name: test/sql/attach/attach_trust_cert.test
# description: Test TrustServerCertificate parameter as alias for Encrypt
# group: [attach]

require mssql

#
# Test 1: Conflicting Encrypt and TrustServerCertificate values should fail
#
statement error
ATTACH 'Server=localhost,1433;Database=master;User Id=sa;Password=test;Encrypt=true;TrustServerCertificate=false' AS mssql_conflict (TYPE mssql);
----
Conflicting values

#
# Test 2: Verify no catalog after conflicting parameter attempt
#
query I
SELECT COUNT(*) FROM duckdb_databases() WHERE database_name = 'mssql_conflict';
----
0

#
# Test 3: Conflicting values in reverse order
#
statement error
ATTACH 'Server=localhost,1433;Database=master;User Id=sa;Password=test;TrustServerCertificate=true;Encrypt=false' AS mssql_conflict2 (TYPE mssql);
----
Conflicting values

#
# Test 4: Verify no catalog after second conflicting parameter attempt
#
query I
SELECT COUNT(*) FROM duckdb_databases() WHERE database_name = 'mssql_conflict2';
----
0

#
# Test 5: Same values for both parameters (Encrypt=true, TrustServerCertificate=true) should not conflict
# Note: This will fail at connection validation (not at parsing), proving no conflict error
#
statement error
ATTACH 'Server=nonexistent.invalid.host,1433;Database=master;User Id=sa;Password=test;Encrypt=true;TrustServerCertificate=true' AS mssql_same_values (TYPE mssql);
----
MSSQL connection validation failed

#
# Test 6: Verify no catalog after same-values attempt (connection fails, not conflict)
#
query I
SELECT COUNT(*) FROM duckdb_databases() WHERE database_name = 'mssql_same_values';
----
0

#
# Note: Tests for TrustServerCertificate=true with a valid server
# are covered in integration tests that require a running SQL Server.
# The parsing tests above verify the parameter is recognized and
# conflict detection works.
#
