# name: test/sql/rowid/scalar_pk_rowid.test
# description: Tests for rowid with scalar (single-column) primary keys
# group: [rowid]
#
# REQUIRES: SQL Server running on localhost:1433 with TestDB initialized
# Run with: make integration-test

require mssql

require-env MSSQL_TESTDB_DSN

# Attach the TestDB database
statement ok
ATTACH '${MSSQL_TESTDB_DSN}' AS testdb_scalar (TYPE mssql);

# =============================================================================
# INT Primary Key Tests
# =============================================================================

# Test 1: Basic rowid query with INT PK
query II
SELECT rowid, name FROM testdb_scalar.dbo.RowidTestInt WHERE id = 1;
----
1	First

# Test 2: rowid equals id column for INT PK
query III
SELECT rowid, id, rowid = id AS rowid_matches FROM testdb_scalar.dbo.RowidTestInt WHERE id IN (1, 2, 3) ORDER BY id;
----
1	1	true
2	2	true
3	3	true

# Test 3: SELECT rowid and all columns
query IIT
SELECT rowid, id, name FROM testdb_scalar.dbo.RowidTestInt ORDER BY id LIMIT 3;
----
1	1	First
2	2	Second
3	3	Third

# Test 4: Only select rowid (no other columns)
query I
SELECT rowid FROM testdb_scalar.dbo.RowidTestInt WHERE id = 10;
----
10

# =============================================================================
# BIGINT Primary Key Tests
# =============================================================================

# Test 5: rowid with BIGINT PK
query IT
SELECT rowid, data FROM testdb_scalar.dbo.RowidTestBigint WHERE id = 1;
----
1	data_1

# Test 6: rowid with large BIGINT values
query IT
SELECT rowid, data FROM testdb_scalar.dbo.RowidTestBigint WHERE data = 'max_bigint';
----
9223372036854775807	max_bigint

# Test 7: rowid with negative BIGINT values
query IT
SELECT rowid, data FROM testdb_scalar.dbo.RowidTestBigint WHERE data = 'min_bigint';
----
-9223372036854775808	min_bigint

# =============================================================================
# VARCHAR Primary Key Tests
# =============================================================================

# Test 8: rowid with VARCHAR PK
query TT
SELECT rowid, description FROM testdb_scalar.dbo.RowidTestVarchar WHERE code = 'ABC';
----
ABC	Alpha Beta Charlie

# Test 9: rowid VARCHAR PK with special characters
query TT
SELECT rowid, description FROM testdb_scalar.dbo.RowidTestVarchar WHERE code = 'CODE-123';
----
CODE-123	Code with dash and numbers

# Test 10: rowid VARCHAR PK with single character
query TT
SELECT rowid, description FROM testdb_scalar.dbo.RowidTestVarchar WHERE code = 'a';
----
a	Single character

# =============================================================================
# Tests with existing table (TestSimplePK)
# =============================================================================

# Test 11: rowid with existing TestSimplePK table
query IIT
SELECT rowid, id, name FROM testdb_scalar.dbo.TestSimplePK WHERE id <= 2 ORDER BY id;
----
1	1	First Record
2	2	Second Record

# Cleanup
statement ok
DETACH testdb_scalar;
