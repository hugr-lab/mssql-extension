# name: test/sql/mssql_execute.test
# description: Test mssql_execute table function (stub implementation)
# group: [mssql]
#
# NOTE: mssql_execute is currently a stub that returns fixed data.
# It will be implemented with real execution in a future spec.

require mssql

require-env MSSQL_TEST_DSN

# Setup: attach database using connection string
statement ok
ATTACH '${MSSQL_TEST_DSN}' AS execdb (TYPE mssql);

# T031: Test mssql_execute with valid context - returns stub response
query III
SELECT * FROM mssql_execute('execdb', 'SELECT 1');
----
true	1	Query executed successfully (stub)

# T032: Test mssql_execute with invalid context (should fail)
statement error
SELECT * FROM mssql_execute('nonexistent_context', 'SELECT 1');
----
Unknown context

# T033: Test return schema (success BOOLEAN, affected_rows BIGINT, message VARCHAR)
query III
SELECT typeof(success), typeof(affected_rows), typeof(message)
FROM mssql_execute('execdb', 'SELECT 1');
----
BOOLEAN	BIGINT	VARCHAR

# Test that result has exactly 1 row
query I
SELECT COUNT(*) FROM mssql_execute('execdb', 'SELECT 1');
----
1

# Test success value is true in stub mode
query I
SELECT success FROM mssql_execute('execdb', 'SELECT 1');
----
true

# Cleanup
statement ok
DETACH execdb;
