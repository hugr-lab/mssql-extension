# name: test/sql/copy/copy_types.test
# description: Test COPY TO MSSQL with various data types
# group: [copy]

require mssql

require-env MSSQL_TESTDB_DSN

statement ok
ATTACH '${MSSQL_TESTDB_DSN}' AS db (TYPE mssql);

# Test integer types
statement ok
CREATE TABLE int_types AS SELECT
    1::TINYINT AS tiny_val,
    100::SMALLINT AS small_val,
    1000::INTEGER AS int_val,
    1000000::BIGINT AS big_val;

statement ok
DROP TABLE IF EXISTS db.dbo.copy_int_types;

statement ok
COPY int_types TO 'mssql://db/dbo/copy_int_types' (FORMAT 'bcp', CREATE_TABLE true);

query IIII
SELECT * FROM db.dbo.copy_int_types;
----
1	100	1000	1000000

statement ok
DROP TABLE IF EXISTS db.dbo.copy_int_types;

statement ok
DROP TABLE int_types;

# Test float types
statement ok
CREATE TABLE float_types AS SELECT
    3.14::FLOAT AS float_val,
    2.71828::DOUBLE AS double_val;

statement ok
DROP TABLE IF EXISTS db.dbo.copy_float_types;

statement ok
COPY float_types TO 'mssql://db/dbo/copy_float_types' (FORMAT 'bcp', CREATE_TABLE true);

query II
SELECT ROUND(float_val, 2), ROUND(double_val, 5) FROM db.dbo.copy_float_types;
----
3.14	2.71828

statement ok
DROP TABLE IF EXISTS db.dbo.copy_float_types;

statement ok
DROP TABLE float_types;

# Test string types
statement ok
CREATE TABLE string_types AS SELECT
    'Hello'::VARCHAR AS str_val,
    'A longer string with spaces'::VARCHAR AS long_str;

statement ok
DROP TABLE IF EXISTS db.dbo.copy_string_types;

statement ok
COPY string_types TO 'mssql://db/dbo/copy_string_types' (FORMAT 'bcp', CREATE_TABLE true);

query II
SELECT * FROM db.dbo.copy_string_types;
----
Hello	A longer string with spaces

statement ok
DROP TABLE IF EXISTS db.dbo.copy_string_types;

statement ok
DROP TABLE string_types;

# Test boolean type
statement ok
CREATE TABLE bool_types AS SELECT true::BOOLEAN AS bool_true, false::BOOLEAN AS bool_false;

statement ok
DROP TABLE IF EXISTS db.dbo.copy_bool_types;

statement ok
COPY bool_types TO 'mssql://db/dbo/copy_bool_types' (FORMAT 'bcp', CREATE_TABLE true);

query II
SELECT * FROM db.dbo.copy_bool_types;
----
1	0

statement ok
DROP TABLE IF EXISTS db.dbo.copy_bool_types;

statement ok
DROP TABLE bool_types;

# Test date type
statement ok
CREATE TABLE date_types AS SELECT DATE '2024-06-15' AS date_val;

statement ok
DROP TABLE IF EXISTS db.dbo.copy_date_types;

statement ok
COPY date_types TO 'mssql://db/dbo/copy_date_types' (FORMAT 'bcp', CREATE_TABLE true);

query I
SELECT CAST(date_val AS DATE) FROM db.dbo.copy_date_types;
----
2024-06-15

statement ok
DROP TABLE IF EXISTS db.dbo.copy_date_types;

statement ok
DROP TABLE date_types;

statement ok
DETACH db;
